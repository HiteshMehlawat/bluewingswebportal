<div class="flex min-h-screen bg-gray-100 font-sans">
    <!-- Main Content -->
    <div class="flex-1 flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="px-8 py-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 flex items-center gap-3">
                            <span class="material-icons text-blue-600">analytics</span>
                            {{ isStaff ? 'My Activities' : 'Staff Activities' }}
                        </h1>
                        <p class="text-gray-600 mt-1">
                            {{ isStaff ? 'View your attendance, performance metrics, and activity history' : 'Monitor
                            and track staff activities and performance' }}
                        </p>
                    </div>
                    <div class="flex items-center gap-4" *ngIf="!isStaff">
                        <button (click)="loadTodayActivities()"
                            class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                            <span class="material-icons text-sm">today</span>
                            Today's Activities
                        </button>
                        <button (click)="loadWorkloadSummary()"
                            class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                            <span class="material-icons text-sm">work</span>
                            Workload Summary
                        </button>
                        <button (click)="refreshData()"
                            class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                            <span class="material-icons text-sm">refresh</span>
                            Refresh Data
                        </button>
                    </div>
                    <div class="flex items-center gap-4" *ngIf="isStaff">
                        <button (click)="loadMyActivitiesToday()"
                            class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                            <span class="material-icons text-sm">schedule</span>
                            My Activities
                        </button>
                        <button (click)="loadMyPerformance()"
                            class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                            <span class="material-icons text-sm">analytics</span>
                            Performance
                        </button>
                        <button (click)="refreshData()"
                            class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                            <span class="material-icons text-sm">refresh</span>
                            Refresh
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Content -->
        <main class="flex-1 p-8 overflow-y-auto">
            <div *ngIf="loading" class="flex justify-center items-center h-64">
                <span class="text-lg text-gray-500">Loading...</span>
            </div>

            <div *ngIf="error" class="flex flex-col justify-center items-center h-64">
                <span class="text-lg text-red-500 mb-4">{{ error }}</span>
                <button (click)="clearError(); refreshData()"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                    <span class="material-icons text-sm">refresh</span>
                    Retry
                </button>
            </div>

            <ng-container *ngIf="!loading && !error">
                <!-- Staff View Content -->
                <div *ngIf="isStaff" class="space-y-6">

                    <!-- My Activities Section -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            My Activities (Today)
                        </h3>

                        <div *ngIf="activitiesLoading" class="flex justify-center py-4">
                            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                        </div>

                        <div *ngIf="!activitiesLoading" class="max-h-96 overflow-y-auto space-y-3 pr-2">
                            <div *ngFor="let record of myActivitiesToday" class="border-l-4 border-blue-500 pl-4 py-2">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="font-medium text-gray-900">{{ record.activityType }}</p>
                                        <p class="text-sm text-gray-600">{{ record.taskDescription }}</p>
                                        <p class="text-xs text-gray-500">{{ formatDate(record.logDate) }}</p>
                                    </div>
                                    <div class="text-right">
                                        <p *ngIf="record.loginTime" class="text-sm font-medium text-green-600">
                                            Login: {{ formatTime(record.loginTime) }}
                                        </p>
                                        <p *ngIf="record.logoutTime" class="text-sm font-medium text-red-600">
                                            Logout: {{ formatTime(record.logoutTime) }}
                                        </p>
                                        <p *ngIf="record.durationMinutes" class="text-xs text-gray-500">
                                            Duration: {{ formatDuration(record.durationMinutes) }}
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div *ngIf="myActivitiesToday.length === 0" class="text-center py-4 text-gray-500">
                                No activities found for today
                            </div>
                        </div>
                    </div>

                    <!-- My Performance Metrics -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                                </path>
                            </svg>
                            Performance Metrics (Last 30 Days)
                        </h3>

                        <div *ngIf="performanceLoading" class="flex justify-center py-4">
                            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                        </div>

                        <div *ngIf="!performanceLoading && myPerformance" class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-blue-50 rounded-lg p-3 text-center">
                                    <div class="text-lg font-bold text-blue-700">{{ myPerformance.totalActivities }}
                                    </div>
                                    <div class="text-xs text-blue-600">Total Activities</div>
                                </div>
                                <div class="bg-green-50 rounded-lg p-3 text-center">
                                    <div class="text-lg font-bold text-green-700">{{ myPerformance.totalCompletedTasks
                                        }}</div>
                                    <div class="text-xs text-green-600">Completed Tasks</div>
                                </div>
                                <div class="bg-yellow-50 rounded-lg p-3 text-center">
                                    <div class="text-lg font-bold text-yellow-700">{{ myPerformance.totalPendingTasks }}
                                    </div>
                                    <div class="text-xs text-yellow-600">Pending Tasks</div>
                                </div>
                                <div class="bg-red-50 rounded-lg p-3 text-center">
                                    <div class="text-lg font-bold text-red-700">{{ myPerformance.totalDelayedTasks }}
                                    </div>
                                    <div class="text-xs text-red-600">Delayed Tasks</div>
                                </div>
                            </div>

                            <div class="border-t pt-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-700">Work Hours</span>
                                    <span class="text-sm text-gray-600">{{
                                        myPerformance.averageWorkHoursPerDay?.toFixed(1) }}h/day avg</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-700">Total Work Time</span>
                                    <span class="text-sm text-gray-600">{{ formatDuration(myPerformance.totalWorkMinutes
                                        || 0) }}</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-700">Login Sessions</span>
                                    <span class="text-sm text-gray-600">{{ myPerformance.totalLoginCount }} ({{
                                        myPerformance.completedSessions || 0 }} completed)</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-700">Avg Session Length</span>
                                    <span class="text-sm text-gray-600">{{
                                        myPerformance.averageSessionLength?.toFixed(1) || 0 }}h</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-700">Total Work Hours</span>
                                    <span class="text-sm text-gray-600">{{ myPerformance.totalWorkHours?.toFixed(1) || 0
                                        }}h</span>
                                </div>
                            </div>
                        </div>

                        <div *ngIf="!performanceLoading && !myPerformance" class="text-center py-4 text-gray-500">
                            No performance data available
                        </div>
                    </div>

                    <!-- Today's Summary -->
                    <div *ngIf="myDailySummary" class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                </path>
                            </svg>
                            Today's Summary
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center">
                                <div class="text-lg font-bold text-blue-600">{{ myDailySummary.totalActivities || 0 }}
                                </div>
                                <div class="text-xs text-gray-600">Activities</div>
                            </div>
                            <div class="text-center">
                                <div class="text-lg font-bold text-green-600">{{ myDailySummary.completedTasks || 0 }}
                                </div>
                                <div class="text-xs text-gray-600">Completed</div>
                            </div>
                            <div class="text-center">
                                <div class="text-lg font-bold text-yellow-600">{{ myDailySummary.pendingTasks || 0 }}
                                </div>
                                <div class="text-xs text-gray-600">Pending</div>
                            </div>
                            <div class="text-center">
                                <div class="text-lg font-bold text-purple-600">{{
                                    formatDuration(myDailySummary.totalDurationMinutes || 0) }}</div>
                                <div class="text-xs text-gray-600">Work Time</div>
                            </div>
                        </div>
                        <div class="mt-4 grid grid-cols-2 md:grid-cols-3 gap-4">
                            <div class="text-center">
                                <div class="text-sm font-bold text-blue-600">{{ myDailySummary.loginCount || 0 }}
                                </div>
                                <div class="text-xs text-gray-600">Login Sessions</div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm font-bold text-red-600">{{ myDailySummary.logoutCount || 0 }}
                                </div>
                                <div class="text-xs text-gray-600">Logout Sessions</div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm font-bold text-indigo-600">{{
                                    myDailySummary.totalWorkHours?.toFixed(1) || 0 }}h
                                </div>
                                <div class="text-xs text-gray-600">Total Hours</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin View Content -->
                <div *ngIf="!isStaff">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow p-6 flex items-center gap-4">
                            <span class="material-icons text-3xl text-blue-500">analytics</span>
                            <div>
                                <div class="text-xs text-gray-500">Total Activities</div>
                                <div class="text-xl font-bold">
                                    {{ stats.totalActivities }}
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow p-6 flex items-center gap-4">
                            <span class="material-icons text-3xl text-green-500">person</span>
                            <div>
                                <div class="text-xs text-gray-500">Active Staff</div>
                                <div class="text-xl font-bold">{{ stats.activeStaff }}</div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow p-6 flex items-center gap-4">
                            <span class="material-icons text-3xl text-yellow-500">schedule</span>
                            <div>
                                <div class="text-xs text-gray-500">Avg Activity Time</div>
                                <div class="text-xl font-bold">
                                    {{ stats.averageActivityTime }}h
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow p-6 flex items-center gap-4">
                            <span class="material-icons text-3xl text-purple-500">star</span>
                            <div>
                                <div class="text-xs text-gray-500">Most Active</div>
                                <div class="text-xl font-bold">
                                    {{ stats.mostActiveStaff }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Workload Summary Table -->
                    <div *ngIf="showWorkloadSummary" class="bg-white rounded-xl shadow p-6 mb-8">
                        <h2 class="text-lg font-semibold text-gray-700 mb-4 flex items-center gap-2">
                            <span class="material-icons text-purple-500">work</span>
                            Staff Workload Summary ({{
                            selectedDate | date : 'mediumDate'
                            }})
                        </h2>

                        <div class="overflow-x-auto">
                            <table class="min-w-full text-sm text-left border-collapse">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 font-semibold">Staff Name</th>
                                        <th class="px-4 py-2 font-semibold">Employee ID</th>
                                        <th class="px-4 py-2 font-semibold">Department</th>
                                        <th class="px-4 py-2 font-semibold">Total Activities</th>
                                        <th class="px-4 py-2 font-semibold">Completed Tasks</th>
                                        <th class="px-4 py-2 font-semibold">Pending Tasks</th>
                                        <th class="px-4 py-2 font-semibold">Delayed Tasks</th>
                                        <th class="px-4 py-2 font-semibold">Assigned Clients</th>
                                        <th class="px-4 py-2 font-semibold">Work Hours</th>
                                        <th class="px-4 py-2 font-semibold">Last Activity</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let workload of workloadSummary || []"
                                        class="even:bg-gray-50 hover:bg-blue-50">
                                        <td class="px-4 py-2 font-medium">
                                            {{ workload.staffName }}
                                        </td>
                                        <td class="px-4 py-2">{{ workload.employeeId }}</td>
                                        <td class="px-4 py-2">{{ workload.department }}</td>
                                        <td class="px-4 py-2 text-center">
                                            {{ workload.totalActivities }}
                                        </td>
                                        <td class="px-4 py-2 text-center text-green-600 font-bold">
                                            {{ workload.completedTasks }}
                                        </td>
                                        <td class="px-4 py-2 text-center text-yellow-600 font-bold">
                                            {{ workload.pendingTasks }}
                                        </td>
                                        <td class="px-4 py-2 text-center text-red-600 font-bold">
                                            {{ workload.delayedTasks }}
                                        </td>
                                        <td class="px-4 py-2 text-center">
                                            {{ workload.assignedClients }}
                                        </td>
                                        <td class="px-4 py-2 text-center">
                                            {{ (workload.totalWorkMinutes / 60).toFixed(1) }}h
                                        </td>
                                        <td class="px-4 py-2">
                                            {{ workload.lastActivity | date : 'short' }}
                                        </td>
                                    </tr>
                                    <tr *ngIf="(workloadSummary || []).length === 0">
                                        <td class="px-4 py-2 text-center text-gray-400" colspan="10">
                                            No workload data found
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Activity Timeline -->
                    <div class="bg-white rounded-xl shadow p-6 mb-8">
                        <h2 class="text-lg font-semibold text-gray-700 mb-4 flex items-center gap-2">
                            <span class="material-icons text-blue-500">timeline</span>
                            Recent Activities
                        </h2>

                        <div class="max-h-[400px] overflow-y-auto space-y-4">
                            <div *ngFor="let activity of activities || []"
                                class="flex items-start gap-4 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                <div class="flex-shrink-0">
                                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                        <span class="material-icons text-blue-600 text-lg">
                                            {{ getActivityIcon(activity.activityType) }}
                                        </span>
                                    </div>
                                </div>

                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-sm font-medium text-gray-900">
                                            {{ activity.staffName }}
                                        </h3>
                                        <span class="text-xs text-gray-500">{{
                                            activity.createdAt | date : 'short'
                                            }}</span>
                                    </div>
                                    <p class="text-sm text-gray-600 mt-1">
                                        {{ activity.taskDescription }}
                                    </p>
                                    <div class="flex items-center gap-4 mt-2">
                                        <span
                                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                            [ngClass]="{
                        'bg-green-100 text-green-800':
                          activity.workStatus === 'COMPLETED',
                        'bg-yellow-100 text-yellow-800':
                          activity.workStatus === 'IN_PROGRESS',
                        'bg-blue-100 text-blue-800':
                          activity.workStatus === 'PENDING',
                        'bg-red-100 text-red-800':
                          activity.workStatus === 'DELAYED'
                      }">
                                            {{ activity.workStatus }}
                                        </span>
                                        <span class="text-xs text-gray-500">{{
                                            activity.activityType
                                            }}</span>
                                        <span *ngIf="activity.durationMinutes" class="text-xs text-gray-500">
                                            Duration: {{ activity.durationMinutes }}m
                                        </span>
                                        <span *ngIf="activity.clientName" class="text-xs text-gray-500">
                                            Client: {{ activity.clientName }}
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div *ngIf="(activities || []).length === 0" class="text-center py-8">
                                <span class="material-icons text-gray-400 text-4xl mb-2">inbox</span>
                                <p class="text-gray-500">No activities found</p>
                            </div>
                        </div>
                    </div>


                </div>
            </ng-container>
        </main>
    </div>
</div>